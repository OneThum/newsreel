
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="30">
    <title>Newsreel API Health Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a73e8;
            border-bottom: 3px solid #1a73e8;
            padding-bottom: 10px;
        }
        h2 {
            color: #333;
            margin-top: 30px;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #1a73e8;
        }
        .metric-card.healthy {
            border-left-color: #34a853;
        }
        .metric-card.degraded {
            border-left-color: #fbbc04;
        }
        .metric-card.error {
            border-left-color: #ea4335;
        }
        .metric-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-healthy {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status-degraded {
            background: #fff8e1;
            color: #f57f17;
        }
        .status-error {
            background: #ffebee;
            color: #c62828;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .timestamp {
            color: #666;
            font-size: 14px;
        }
        .auto-refresh {
            display: inline-block;
            margin-left: 15px;
            padding: 4px 12px;
            background: #e3f2fd;
            color: #1565c0;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #2196f3;
            color: white;
        }
        .btn-primary:hover {
            background: #1976d2;
        }
        .btn-success {
            background: #4caf50;
            color: white;
        }
        .btn-success:hover {
            background: #388e3c;
        }
        .btn-secondary {
            background: #757575;
            color: white;
        }
        .btn-secondary:hover {
            background: #616161;
        }
        .test-results {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
        .test-passed {
            color: #2e7d32;
        }
        .test-failed {
            color: #c62828;
        }
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
        }
        .btn-danger {
            background: #d32f2f;
            color: white;
        }
        .btn-danger:hover {
            background: #b71c1c;
        }
        .btn-warning {
            background: #f57c00;
            color: white;
        }
        .btn-warning:hover {
            background: #e65100;
        }
        .cleanup-section {
            background: #fff3e0;
            border: 2px solid #f57c00;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning-text {
            color: #d32f2f;
            font-weight: 600;
            margin: 10px 0;
        }
    </style>
    <script>
        function copyCommand(command) {
            navigator.clipboard.writeText(command).then(function() {
                alert('Command copied to clipboard!\n\nPaste it in your terminal to run.');
            }, function(err) {
                alert('Could not copy command: ' + err);
            });
        }
        
        function showInstructions(type) {
            const basePath = 'cd ~/Library/CloudStorage/OneDrive-OneThumSoftware/One\\ Thum\\ Software/Newsreel/Azure/tests';
            const instructions = {
                'unit': basePath + ' && pytest unit/ -v --json-report --json-report-file=reports/.report.json && python3 scripts/save_test_results.py',
                'integration': basePath + ' && pytest integration/ -v --json-report --json-report-file=reports/.report.json && python3 scripts/save_test_results.py',
                'all': basePath + ' && pytest -v --json-report --json-report-file=reports/.report.json && python3 scripts/save_test_results.py',
                'diagnostics': basePath + ' && ./run_all_diagnostics.sh'
            };
            
            const command = instructions[type];
            if (command) {
                if (confirm('Copy this command to clipboard?\n\n' + command)) {
                    copyCommand(command);
                }
            }
        }
        
        function showCleanupCommand(type) {
            const basePath = 'cd ~/Library/CloudStorage/OneDrive-OneThumSoftware/One\\ Thum\\ Software/Newsreel/Azure/tests';
            const commands = {
                'cleanup_all': basePath + ' && python3 scripts/cleanup_all_articles.py',
                'cleanup_old': basePath + ' && python3 scripts/cleanup_old_articles.py'
            };
            
            const warnings = {
                'cleanup_all': '‚ö†Ô∏è  EXTREME CAUTION ‚ö†Ô∏è\n\nThis will DELETE ALL ARTICLES from Cosmos DB!\n\nThis operation is PERMANENT and CANNOT BE UNDONE!\n\nYou will be asked for multiple confirmations before deletion.\n\nAre you sure you want to copy this command?',
                'cleanup_old': '‚ö†Ô∏è  WARNING ‚ö†Ô∏è\n\nThis will delete all articles EXCEPT those from the last hour.\n\nThis operation is PERMANENT and CANNOT BE UNDONE!\n\nYou will be asked for confirmation before deletion.\n\nCopy this command?'
            };
            
            if (confirm(warnings[type])) {
                copyCommand(commands[type]);
                alert('Command copied!\n\nIMPORTANT: Read all prompts carefully before confirming deletion.');
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Newsreel API Health Report</h1>
        <p class="timestamp">Generated: 2025-10-26 03:24:14 UTC <span class="auto-refresh">üîÑ Auto-refreshes every 30s</span></p>
        
        <h2>System Overview</h2>
        <div class="metric-grid">
            <div class="metric-card healthy">
                <div class="metric-label">Total Articles</div>
                <div class="metric-value">73,700</div>
            </div>
            <div class="metric-card healthy">
                <div class="metric-label">Total Stories</div>
                <div class="metric-value">51,665</div>
            </div>
            <div class="metric-card degraded">
                <div class="metric-label">Summary Coverage</div>
                <div class="metric-value">24.6%</div>
            </div>
            <div class="metric-card degraded">
                <div class="metric-label">Multi-Source Rate</div>
                <div class="metric-value">0.0%</div>
            </div>
        </div>
        
        <h2>Component Health</h2>
        <table>
            <tr>
                <th>Component</th>
                <th>Status</th>
                <th>Key Metric</th>
            </tr>
            <tr>
                <td>Database</td>
                <td><span class="status-badge status-healthy">healthy</span></td>
                <td>1612 articles/hour</td>
            </tr>
            <tr>
                <td>RSS Ingestion</td>
                <td><span class="status-badge status-healthy">healthy</span></td>
                <td>144.3 articles/min</td>
            </tr>
            <tr>
                <td>Story Clustering</td>
                <td><span class="status-badge status-degraded">degraded</span></td>
                <td>0.00 avg sources</td>
            </tr>
            <tr>
                <td>AI Summarization</td>
                <td><span class="status-badge status-degraded">degraded</span></td>
                <td>0 summaries/day</td>
            </tr>
        </table>
        
        <h2>RSS Ingestion Details</h2>
        <div class="metric-grid">
            <div class="metric-card">
                <div class="metric-label">Articles (10 min)</div>
                <div class="metric-value">1443</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Unique Sources</div>
                <div class="metric-value">32</div>
            </div>
        </div>
        
        <h2>Clustering Quality</h2>
        <div class="metric-grid">
            <div class="metric-card">
                <div class="metric-label">Stories (24h)</div>
                <div class="metric-value">0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Avg Sources/Story</div>
                <div class="metric-value">0.00</div>
            </div>
        </div>
        
        <h2>AI Summarization</h2>
        <div class="metric-grid">
            <div class="metric-card">
                <div class="metric-label">Generation Time</div>
                <div class="metric-value">0ms</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Cost (24h)</div>
                <div class="metric-value">$0.00</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üß™ Test Suite</h2>
            <p>Run tests to verify system functionality and update this report with results.</p>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="showInstructions('diagnostics')">
                    üîç Run Diagnostics
                </button>
                <button class="btn btn-success" onclick="showInstructions('unit')">
                    ‚öôÔ∏è Run Unit Tests
                </button>
                <button class="btn btn-success" onclick="showInstructions('integration')">
                    üîó Run Integration Tests
                </button>
                <button class="btn btn-secondary" onclick="showInstructions('all')">
                    üöÄ Run All Tests
                </button>
            </div>
            
            
        <div class="test-results">
            <p><strong>‚ùå Last Test Run:</strong> 2025-10-26T03:22:28.599808+00:00</p>
            <p class="test-failed">
                <strong>96/123 tests passed</strong> (78.0%)
                <span class='test-failed'> | 18 failed</span>
            </p>
            <p>Duration: 2.11s</p>
        </div>
        
        </div>
        
        <div class="cleanup-section">
            <h2>üóëÔ∏è Database Cleanup</h2>
            <p class="warning-text">‚ö†Ô∏è  DESTRUCTIVE OPERATIONS - USE WITH EXTREME CAUTION</p>
            <p>These operations permanently delete articles from Cosmos DB. They cannot be undone!</p>
            
            <div class="button-group">
                <button class="btn btn-warning" onclick="showCleanupCommand('cleanup_old')">
                    üßπ Delete Old Articles (Keep Last Hour)
                </button>
                <button class="btn btn-danger" onclick="showCleanupCommand('cleanup_all')">
                    ‚ö†Ô∏è DELETE ALL ARTICLES
                </button>
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 4px; font-size: 13px;">
                <p><strong>What these do:</strong></p>
                <ul>
                    <li><strong>Delete Old Articles:</strong> Removes all articles except those ingested in the last hour. Useful for maintaining a small test dataset.</li>
                    <li><strong>DELETE ALL ARTICLES:</strong> Removes EVERY article from the database. Only use this if you want to completely reset the system.</li>
                </ul>
                <p style="color: #d32f2f;"><strong>‚ö†Ô∏è  Both operations require confirmation prompts before executing.</strong></p>
            </div>
        </div>
        
        <h2>üìä Raw Data</h2>
        <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;">
{
  "database": {
    "total_articles": 73700,
    "total_stories": 51665,
    "articles_last_hour": 1612,
    "stories_last_hour": 0,
    "health": "healthy"
  },
  "rss": {
    "articles_last_10_min": 1443,
    "articles_per_minute": 144.3,
    "unique_sources": 32,
    "top_sources": [
      [
        "guardian",
        172
      ],
      [
        "dw",
        144
      ],
      [
        "telegraph",
        118
      ],
      [
        "independent",
        100
      ],
      [
        "thehill",
        96
      ]
    ],
    "health": "healthy"
  },
  "clustering": {
    "stories_last_24h": 0,
    "avg_sources_per_story": 0,
    "multi_source_rate": 0,
    "status_distribution": {},
    "health": "degraded"
  },
  "summarization": {
    "coverage": 24.63369786122133,
    "summaries_24h": 0,
    "avg_generation_time_ms": 0,
    "avg_word_count": 0,
    "cost_24h": 0,
    "health": "degraded"
  },
  "performance": {
    "unprocessed_articles": 6849,
    "health": "degraded"
  },
  "tests": {
    "last_run": {
      "timestamp": "2025-10-26T03:22:28.599808+00:00",
      "total": 123,
      "passed": 96,
      "failed": 18,
      "skipped": 9,
      "error": 0,
      "duration": 2.1105430126190186,
      "exitcode": 1
    },
    "unit_tests_available": true,
    "integration_tests_available": true
  }
}
        </pre>
    </div>
</body>
</html>
